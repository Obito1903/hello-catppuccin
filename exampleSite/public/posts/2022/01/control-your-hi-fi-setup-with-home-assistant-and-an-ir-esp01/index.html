<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Samuel Rodrigues"><meta name=description content="I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by Home-Assistant, an open-source home automation tool."><meta name=keywords content=",home-assistant,esphome,esp01"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=http://192.168.27.65:1313/posts/2022/01/control-your-hi-fi-setup-with-home-assistant-and-an-ir-esp01/><title>Control your HI-FI setup with Home-assistant and an IR-ESP01 ::
Samuel Rodrigues
â€” Portofolio, Thoughts, stories and ideas from my everyday life.</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;500&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500&display=swap" rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=http://192.168.27.65:1313/main.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link type=text/css rel=stylesheet href=http://192.168.27.65:1313/styles/tw-main-dist.min.4103dacac6aaf088c09b7acca25a866fd77fb9a81a1ca21bb4b744f65c677c70.css integrity="sha256-QQPaysaq8IjAm3rMolqGb9d/uagaHKIbtLdE9lxnfHA="><meta itemprop=name content="Control your HI-FI setup with Home-assistant and an IR-ESP01"><meta itemprop=description content="I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by Home-Assistant, an open-source home automation tool."><meta itemprop=datePublished content="2022-01-25T17:13:00+01:00"><meta itemprop=dateModified content="2022-01-25T17:13:00+01:00"><meta itemprop=wordCount content="918"><meta itemprop=image content="http://192.168.27.65:1313/"><meta itemprop=keywords content="home-assistant,esphome,esp01,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://192.168.27.65:1313/"><meta name=twitter:title content="Control your HI-FI setup with Home-assistant and an IR-ESP01"><meta name=twitter:description content="I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by Home-Assistant, an open-source home automation tool."><meta property="og:title" content="Control your HI-FI setup with Home-assistant and an IR-ESP01"><meta property="og:description" content="I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by Home-Assistant, an open-source home automation tool."><meta property="og:type" content="article"><meta property="og:url" content="http://192.168.27.65:1313/posts/2022/01/control-your-hi-fi-setup-with-home-assistant-and-an-ir-esp01/"><meta property="og:image" content="http://192.168.27.65:1313/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-25T17:13:00+01:00"><meta property="article:modified_time" content="2022-01-25T17:13:00+01:00"><meta property="og:site_name" content="Samuel Rodrigues"><meta property="article:published_time" content="2022-01-25 17:13:00 +0100 CET"></head><body class="bg-base text-text flex flex-col" style=height:100svh><div class="flex flex-col grow"><header class="bg-crust h-14 shadow-md"><div class="md:mx-auto flex flex-row h-full justify-between"><a class="font-bold font-mono align-middle flex items-center space-x-1 ml-2" href=http://192.168.27.65:1313/><span class="font-bold text-2xl">></span>
<span class="font-bold text-2xl">Obito1903</span></a><div class=hidden></div></div></header><div class="mx-4 grow overflow-y-scroll"><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>5 minutes
|
Also available in
<a href=http://192.168.27.65:1313/fr/posts/2022/01/contr%C3%B4ler-votre-installation-hi-fi-avec-home-assistant-et-un-ir-esp01./><span class="flag flag-icon flag-icon-fr flag-icon-squared"></span></a></p></div><article><h1 class=post-title><a href=http://192.168.27.65:1313/posts/2022/01/control-your-hi-fi-setup-with-home-assistant-and-an-ir-esp01/>Control your HI-FI setup with Home-assistant and an IR-ESP01</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#getting-your-remote-ir-codes>Getting your remote IR-codes</a></li><li><a href=#setting-up-esphome>Setting up ESPHome</a></li><li><a href=#wiring-up-the-ir-transceiver>Wiring up the IR-transceiver</a></li><li><a href=#adding-esphome-to-home-assistant>Adding ESPhome to Home-assistant</a></li></ul></nav></aside><hr><div class=post-content><img src=hass-player.png alt="Home-assistant media-player" class=center style=border-radius:8px><p>I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by <a href=https://www.home-assistant.io/>Home-Assistant</a>, an open-source home automation tool.</p><p>For this project I&rsquo;ll be using a ESP01 board with the <a href=https://esphome.io/>ESPHome</a> framework</p><h2 id=getting-your-remote-ir-codes>Getting your remote IR-codes</h2><p>Before beginning, you&rsquo;ll first need to get your hands on the remote IR-codes,
to then be able to clone them with the ESP01. You have multiple option for that :</p><ul><li>Find your remote or one compatible with your device on sites that list remote
IR-codes like Remote Central</li><li>Record them yourself with the help of an IR-receiver module (ex : VS1838B)
connected to your ESP.</li></ul><p>Personally, since I did not have a receiver on hand, I went with Remote Central.
On the website, you&rsquo;ll be presented with a list of the different functions for
the remote you choose and their associated <code>Pronto</code> code. The format of the code
might be different depending on the website where you found it, but in most cases,
you&rsquo;ll be able to use them. To see if your protocol is compatible with ESPHome,
check <a href=https://esphome.io/components/remote_transmitter.html>here</a></p><h2 id=setting-up-esphome>Setting up ESPHome</h2><p>ESPHome is a tool to easily connect, and configure devices like Arduino, and ESP
to Home Assistant. In this guide, we will use the CLI version of this tool in a
docker container.</p><p>Go to a folder where you want to put the configuration for ESP then initialize
the ESPHome project :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -v <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>:/config -it esphome/esphome wizard ir_remote.yaml
</span></span></code></pre></div><p>This command will ask you to enter some information on the device you want to
flash, name of the device, platform, board name, information about the network
to which you want it to connect to, and finally the password of the ESPHome API
that will be hosted on the board. At the end of the process, a YAML file will
be generated with the name you specified earlier.
It should look something like that :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>esphome</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ir_remote</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>esp8266</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>board</span>: <span style=color:#ae81ff>esp01</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable logging</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logger</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable Home Assistant API</span>
</span></span><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;azertyuiop&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>ota</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;azertyuiop&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>wifi</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ssid</span>: <span style=color:#e6db74>&#34;hello&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;azertyuiop&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Enable fallback hotspot (captive portal) in case wifi connection fails</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ap</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssid</span>: <span style=color:#e6db74>&#34;IR-Remote Fallback Hotspot&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;superstrongpassword&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>captive_portal</span>:
</span></span></code></pre></div><p>Next, we will need to tell ESPhome to create an IR transceiver. To do that, first,
we&rsquo;ll need to define a <code>remote_transmitter</code> entry in our configuration file :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>remote_transmitter</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>carrier_duty_percent</span>: <span style=color:#ae81ff>50</span><span style=color:#ae81ff>%</span>
</span></span></code></pre></div><p>Just change the pin entry to the pin to which youre IR-led will be connected.</p><p>Next, we&rsquo;ll have to add a <code>button</code> entity for each button that you want to emulate.
Just add the button section to the YAML, and add a template platform for each
of your buttons :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>button</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>template</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>amp_power_btn</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Amp Power Button</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>on_press</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>template</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>amp_vol_plus</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Amp Vol+</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>on_press</span>:
</span></span></code></pre></div><p>Then for each of the buttons, we need to specify a corresponding code to send when
it is activated. For that, we need to add an action for each button under the
<code>on_press</code> section. You can find a list of possible action <a href=https://esphome.io/components/remote_transmitter.html#remote-transmitter-actions>here</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>template</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>amp_power_btn</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Amp Power Button</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>on_press</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>remote_transmitter.transmit_pronto</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>data</span>: <span style=color:#e6db74>&#34;Some pronto hex code&#34;</span>
</span></span></code></pre></div><p>In some cases, the device you want to automate will need the code to be repeated
multiple times for it to be registered. To do that you can just add a <code>repeat</code>
section under our action. In my case, my amp requires the code to be sent 2 times :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>remote_transmitter.transmit_pronto</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>data</span>: <span style=color:#e6db74>&#34;Some pronto hex code&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>repeat</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>times</span>: <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>Once you&rsquo;re done adding all your buttons we can move on to uploading the config to your ESP. To do that just plug your device in your computer and start the compilation and upload process with ESPhome :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -v <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>:/config --device<span style=color:#f92672>=</span>/dev/ttyUSB0 -it esphome/esphome run ir_remote.yaml
</span></span></code></pre></div><p>Where <code>/dev/ttyUSB0</code> is the usb port to which your ESP is connected.</p><h2 id=wiring-up-the-ir-transceiver>Wiring up the IR-transceiver</h2><p>Next step is to build our circuit to drive the led with the ESP.</p><p>You will need :</p><ul><li>A 3.3v power supply</li><li>1x infrared LED</li><li>1x 1k Ohm resistor</li><li>1x PNP Transistor (P2N2222A in my case)</li></ul><p><strong>Circuit diagram :</strong></p><img src=circuit-diagram.png alt="Circuit diagram" class=center style=border-radius:8px><p><br><br></p><img src=circuit-drawing.png alt="Circuit drawing" class=center style=border-radius:8px><p>Once everything is wired up you can power everything. To check if everything is working correctly you can go back to your pc and launch the ESPhome dashboard :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm --net<span style=color:#f92672>=</span>host -v <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>:/config -it esphome/esphome
</span></span></code></pre></div><img src=esp-home-dashboard.png alt="Circuit drawing" class=center style=border-radius:8px><p>If everything is fine you should see your device appear online within a minute or two.</p><h2 id=adding-esphome-to-home-assistant>Adding ESPhome to Home-assistant</h2><p>Finally to add your remote to Home-assistant you have to option :</p><ul><li>Wait for Home-assistant to find your ESPhome device.</li><li>Add it manually if you know its IP address.</li></ul><p>If you choose to add it manually, it&rsquo;s pretty simple just go to the Integrations menu in your Hass settings and add the ESPhome integration. It will prompt you to enter the IP of the ESP. Once done it will check if it can reach it and if so you are done.</p><p>One final note on the button entity, If you want to create a button in your
Lovelace dashboard to control your remote you need to tell the UI button to call
the <strong>Button</strong> service on press and select the button entity to activate.</p><img src=hass-entity.png alt="Circuit drawing" class=center style=border-radius:8px></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>918 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-01-25 17:13</p></div></main></div><footer class="mx-auto text-center text-overlay1"><div><span><a href=http://192.168.27.65:1313/>Samuel Rodrigues</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span>
<span><a href=http://192.168.27.65:1313/%20posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></footer><footer class="sticky inset-x-0 bottom-0 overflow-hidden md:hidden bg-crust flex justify-around"><a class="text-subtext1 flex flex-col items-center px-4 pt-2 pb-2 bg-crust hover:brightness-125" href=about/><span class=text-sm>About</span><div class="mb-1 scale-110"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723.0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723.0 003.065 7.097A9.716 9.716.0 0012 21.75a9.716 9.716.0 006.685-2.653zm-12.54-1.285A7.486 7.486.0 0112 15a7.486 7.486.0 015.855 2.812A8.224 8.224.0 0112 20.25a8.224 8.224.0 01-5.855-2.438zM15.75 9a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z" clip-rule="evenodd"/></svg></div></a><a class="text-subtext1 flex flex-col items-center px-4 pt-2 pb-2 bg-crust hover:brightness-125" href=http://192.168.27.65:1313/posts><span class=text-sm>Blog</span><div class="mb-1 scale-110"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M4.125 3C3.089 3 2.25 3.84 2.25 4.875V18a3 3 0 003 3h15a3 3 0 01-3-3V4.875C17.25 3.839 16.41 3 15.375 3H4.125zM12 9.75a.75.75.0 000 1.5h1.5a.75.75.0 000-1.5H12zm-.75-2.25a.75.75.0 01.75-.75h1.5a.75.75.0 010 1.5H12a.75.75.0 01-.75-.75zM6 12.75a.75.75.0 000 1.5h7.5a.75.75.0 000-1.5H6zm-.75 3.75a.75.75.0 01.75-.75h7.5a.75.75.0 010 1.5H6a.75.75.0 01-.75-.75zM6 6.75a.75.75.0 00-.75.75v3c0 .414.336.75.75.75h3a.75.75.0 00.75-.75v-3A.75.75.0 009 6.75H6z" clip-rule="evenodd"/><path d="M18.75 6.75h1.875c.621.0 1.125.504 1.125 1.125V18a1.5 1.5.0 01-3 0V6.75z"/></svg></div></a><a class="text-subtext1 flex flex-col items-center px-4 pt-2 pb-2 bg-crust hover:brightness-125" href=http://192.168.27.65:1313/projects><span class=text-sm>Projects</span><div class="mb-1 scale-110"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.315 7.584C12.195 3.883 16.695 1.5 21.75 1.5a.75.75.0 01.75.75c0 5.056-2.383 9.555-6.084 12.436A6.75 6.75.0 019.75 22.5.75.75.0 019 21.75v-4.131A15.838 15.838.0 016.382 15H2.25a.75.75.0 01-.75-.75 6.75 6.75.0 017.815-6.666zM15 6.75a2.25 2.25.0 100 4.5 2.25 2.25.0 000-4.5z" clip-rule="evenodd"/><path d="M5.26 17.242a.75.75.0 10-.897-1.203 5.243 5.243.0 00-2.05 5.022.75.75.0 00.625.627 5.243 5.243.0 005.022-2.051.75.75.0 10-1.202-.897A3.744 3.744.0 013.75 20.25c0-1.23.592-2.323 1.51-3.008z"/></svg></div></a></footer></div></body></html>